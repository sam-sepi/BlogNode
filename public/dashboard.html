<!DOCTYPE html>
<html>
    <head>

    </head>
    <body>

        <input type="text" placeholder="Title" id="title">
        <textarea id="text"></textarea>
        <input type="submit" value="Write" onclick="writeArticle();">

        <div id="content"></div>

        <script>

            findCollection();

            async function findCollection()
            {
                let jwt = localStorage.getItem("token");
                
                let request = await fetch('/article', {
                    method: "get",
                    headers: new Headers({
                        'Authorization': 'Bearer ' + jwt
                    })
                });

                let response = await request.json();

                if(response.str == 'Authorized') 
                {
                    let content = document.getElementById('content');
                    let newlink = document.createElement('a');

                    for(i = 0; i < response.docs.length; i++)
                    {
                        let newlink = document.createElement('a');
                        content.appendChild(newlink);
                        newlink.setAttribute('href', 'handle.html/' + response.docs[i]._id);
                        newlink.innerHTML = response.docs[i].article + '<br>';
                    }

                } else
                {
                    window.location.replace("login.html");
                }
            }

            async function writeArticle()
            {
                let jwt = localStorage.getItem("token");
                let title = document.getElementById('title').value;
                let text = document.getElementById('text').value;

                let request = await fetch('/article', {
                    method: "post",
                    headers: new Headers({
                        'Authorization': 'Bearer ' + jwt,
                        "Content-Type": "application/json"
                    }),
                    body: JSON.stringify({
                        title: title,
                        text: text
                    })
                });

                let response = await request.json();

                console.log(response);
            }
        </script>
    </body>
</html>